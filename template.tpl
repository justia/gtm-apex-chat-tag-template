// Copyright 2019 Google LLC

// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at

//     https://www.apache.org/licenses/LICENSE-2.0

// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.

___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Apex Chat",
  "brand": {
    "id": "brand_dummy",
    "displayName": "Justia",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZEAAAGRCAYAAACkIY5XAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAADtVJREFUeNrs3X+olfUdwPHnesUZLLK/1i2Y1yBHMrRuGKuRV4z2j1nGEBrrh4LCBkVzZH9IP2yO/lgyFzYa6MhlMSG2tE3YkvJHrD+KbtZgbQV5/Se3P0ZXEmqy2L6f4zl6u78859xzzn2e57xecbpmZvL1et73++N5np6sDeYs3Twvfbim+opvX1L9NgDtN5xeJ6rfPhb/fOatJ46143/U08JwRCTuTa/lggGQS4fTa3967UtRGZ7xiFRnHD+qxqPf7w9AYcTM5KkUk90dj8ioeDyQnV2uAqCYRqox2dKRiKSALE8fnjXzACiV4fTamGKyr20RSQHZXp2BAFBOEZF1KSYjLYtIdfnqUGbDHKBbZiV31HOia1YdAYlwvCMgAF2jPyYO6f1/9YV+YG8dAYkZyGXGFKCrzE2vO3uvuOnEFx+/fqzhiFSXsF7KbKADdLPVU4VkquWsCIglLACera5M1ReR9IO3ZGevPAeAcKi6QjV1RKq1ecx4ATBKbYvjgjOR7cYKgAksTxONL10r2DNmFrI2O3s1OgBMJC5CXFC7GHHsTMQyFgBTiWWt7eNmItV7Yh0yPgDUIWYjw6NnIvcaEwDq9Ni5mUj12NYnxgSAOlX2RmozkeXGA4AGxORjdS0ig8YDgAbdbiYCQLPOzUTcIwuAhs2as3Rzv2EAoKmIZG71DsA0IgIAIgKAiAAgIgCICACICAAiAoCIACAiAIgIAIgIACICgIgAICIAICIAiAgAIgKAiAAgIgAgIgCICAAiAoCIAICIACAiAIgIACICgIgAQCNmGwLIv2XXLcgOPrO+68fh6NDx7JYf7PIJYSYCgIgAICIAICIAiAgAIgKAiACAiAAgIgCICAAiAoCIAICIACAiAIgIACICACICgIgAICIAiAgAIgIAIgKAiAAgIgCICACICAAiAoCIACAiAIgIAIgIACICgIgAICIAICIAiAgAIgKAiAAgIgAgIgCICAAiAoCIAICIACAiAIgIACICgIgAgIgAICIAiAgAIgIAIgKAiAAgIgCICAAiAgAiAoCIACAiAIgIAIgIACICgIgAICIAiAgAiAgAIgKAiAAgIgAgIgCICAAiAoCIACAiACAiAIgIACICgIgAICIAICIAiAgAIgKAiACAiAAgIgCICAAiAoCIAICIACAiAIgIACICACICgIgAICIAiAgAIgIAIgKAiAAgIgCICACICAAiAoCIACAiAIgIAIgIACICgIgAICIAICIAiAgAIgKAiAAgIgAgIgCICAAiAoCIAICIACAiAIgIACICgIgAgIgAICIAiAgAIgIAIgKAiAAgIgCICAAiAgAiAoCIACAiAIgIAIgIACICgIgAICIAiAgAiAgAIgKAiAAgIgAgIgCICAAiAoCIACAiACAiAIgIACICgIgAgIgAICIAiAgAIgKAiACAiAAgIgCICAAiAoCIAICIACAiAIgIACICACICgIgAICIAiAgAIgIAIgKAiAAgIgCICACICAAiAoCIACAiAIgIAIgIACICgIgAICIAICIAiAgAIgKAiAAgIkBeDQ5caRAQEQBEBABEBIrikovnGgREBGjOkoV9BgERAUBEgA5bfJWZSBj59DODICJAo+bZE6l474N/GgQRARqx7LoFBgERAZqchXz1IoOAiADNcTLrPHsiIgI0yHLWee9+eNIgiAjQCCezEBGgKfP7LnUya5RTn35uEESEoos1+hef/L43tw6wlPVl735gOStvZhsCGhHheOWZ9WcD8miWrdn0gkFpo8EBEcFMhDIGJLltcFG269HvGhgzkY44OnTcIIgIRQ/I2OOmd986ICRtEmMdeyIgIhTeto0rJ71eQUjaI8aV8+yHiAgFFYG40BuakLTebYNXG4RRnMwSEQro/jtvrPsrYiFpHUtZ4x0Z+sggiAhFElHY9uOVDf83QtKaeGMmIiIU1nROXgnJ9MQhBvsh49kTEREKIpZSdk4zAkIynVnItw2CgIgIxQ3I6GtBphuSg79a78r2Bmch91nKGufEyU8MgohQhDewVt/OZNnAgpZFqVtmIcZqPE80FBEKEJB4s2/HiaCY3bz5/H2ei2EW0jTLWSJCzk10NXorRZzi/xEb9kwsLug0CxEREaFwYgO8E7OE2nKZ46vjxT2ynMia2Minn9sTERHyHJBOv3nFtSduJT8mrj+7y0BM4qiLDEWEfGrkavRWi2Wtdi+hFUUcpxbUydlUFxFyqJmr0Vutdpy4m5e34vfAPtHU3O5ERMiZWH/Py4WA8RV4vJF24/UkEXL7Qxd29G3PERERcqPy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"
  },
  "description": "This is an unofficial template for adding \u003ca href\u003d\"https://www.apexchat.com/\"\u003eApex Chat\u003c/a\u003e.",
  "categories": ["CHAT"],
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "companyKey",
    "displayName": "Company Key",
    "simpleValueType": true,
    "help": "Given an Apex Chat URL such as \u003cem\u003ehttps://www.apex.live/scripts/invitation.ashx?company\u003d\u003cstrong\u003emycompany\u003c/strong\u003e\u003c/em\u003e, extract the text after \u003cem\u003e\u003d\u003c/em\u003e, in this case \u003cstrong\u003emycompany\u003c/strong\u003e."
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Require the necessary APIs
const injectScript = require('injectScript');
const queryPermission = require('queryPermission');
const encodeUriComponent = require('encodeUriComponent');

// Logic
const url = "https://www.apex.live/scripts/invitation.ashx?company=" + encodeUriComponent(data.companyKey);

// Handle success
const onSuccess = () => {
  data.gtmOnSuccess();
};

// Handle failures
const onFailure = () => {
  data.gtmOnFailure();
};

// Need to check permissions before injecting scripts
if (queryPermission('inject_script', "https://www.apex.live")) {
  injectScript(url, onSuccess, onFailure);
} else {
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://www.apex.live/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Test script was called
  code: |-
    const mockData = {
      companyKey: "mycompany"
    };

    const scriptUrl = 'https://www.apex.live/scripts/invitation.ashx?company=mycompany';

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('injectScript').wasCalledWith(scriptUrl, success, failure);
    assertApi('gtmOnSuccess').wasCalled();
- name: Test with encoded key
  code: |-
    const mockData = {
      companyKey: "mycompa ny"
    };

    const scriptUrl = 'https://www.apex.live/scripts/invitation.ashx?company=mycompa%20ny';

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('injectScript').wasCalledWith(scriptUrl, success, failure);
    assertApi('gtmOnSuccess').wasCalled();
setup: |-
  // Create injectScript mock
  let success, failure;
  mock('injectScript', (url, onsuccess, onfailure) => {
    success = onsuccess;
    failure = onfailure;
    onsuccess();
  });


___NOTES___

Created on 4/14/2021, 1:44:10 PM


